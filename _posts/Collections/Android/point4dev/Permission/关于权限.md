## 0x00、 官网说明
https://developer.android.com/guide/topics/permissions/overview

## 0x01、 问题
```java
if(checkPermission){//已经被授予
    //完成正常业务逻辑
}else{//尚未被授予
    if(shouldShowRequestPermissionRationale){//应该显示解释信息
        1. 显示解释信息
        2. 根据用户对解释信息的态度决定是否继续权限申请
    }else{//不应该显示解释信息

        //region
        if(firstRequst){//因为这是首次申请权限所以不用显示解释信息

        }else{//因为用户已经勾选过不再询问，所以不再显示提示信息

        }
        //endregion
    }
}
```

我们希望完成 `region` 代码块的逻辑区分。也即是我们希望知道无需显示解释信息是因为用户点击了不在显示权限请求框 checkBox 还是因为这是首次请求该权限。
- 也就是说如果用户勾选了不再提示的时候，我们不知道如何面对用户了。
    - 这个时候如果再次点击需要权限的功能按钮，我们明明知道用户在上一刻的意图，却无法为他做点什么那怕是一个指引。
- 也就是说我们不赞同 Google 的权限设计
    - 因为有些用户在勾选"不在提示之后"不知道到什么地方打开这些开关
    - 另一些用户即使知道到什么地方打开开关，我们又应该在什么时机提醒他们打开去打开开关呢？
        - 现在的做法我只看到一种，在用户拒绝权限之后，提示功能不可用
            - 我认为这个提示大可不必，拒绝权限本身就意味着用户接收该功能不可用这件事儿了。
            - 但是如果没有这个提示我们应该在什么情况下告知用户到设置中打开权限呢？

我们认为权限请求分为三种情况(但这种逻辑好像收到了 Android OS 现有权限管理逻辑的影响)
1. 首次请求，在这种情况下系统会告诉我们无需为该权限解释什么
2. 二次请求，在这中情况下系统会告诉我们，我们有必要为自己申请权限这件事向用户做出必要的解释
    - 只要二次请求中没有勾选不在提示，那么以后的请求都按 二次请求 处理。
    - 一旦用户勾选了不在提示按钮，之后在使用需要该权限的功能，我们就需要按照 三次请求处理了。
3. 三次请求，这时候我们有必要为自己申请权限这件事向用户做出必要的解释
    - 并且告诉它如何从设置中修改权限。

何不分为两种情况呢，在二次请求的时候我们如果不给用户勾选不再提示的机会就可以了。
1. 首次请求，无需向用户解释什么直接申请权限并观察用户反应
2. 二次请求，那肯定首次被拒绝了，这时候被用户必要的解释，并观察用户反应
    - 如果用户有同意授权的意图就请求权限
    - 否则不请求权限

按照两种情况理解，我们总是在真正需要权限的时候才会请求权限

按照三种情况的理解，应该是在应用移动或者功能模块启动的时候申请权限，否则功能模块不可用
- 这种情况下，我们既然开发了应用总是希望用户能用的，如果用户两次拒绝我们今后就不再显示该功能吗？
- 这中情况我无法理解

美团的做法是不想我发出任何提问直接拥有了网络访问权限和定位权限，这说明我们的思路是有解决方案的。
我们认为两种情况的权限请求更合理，那么我们现在以此为目标完成我们的业务逻辑。
同时按照两种权限的模式我们应该为用户提供权限撤销逻辑，指引他快速道设置中撤销已经授予本应用的权限。

![2018-10-11_Android权限逻辑探究.jpg](/assets/Image/2018-10-11_Android权限逻辑探究.jpg)


要完整这个逻辑我们可以
1. 自己保存当前的权限请求状态从二方便我们做出判断
    - 这种是能实现“”
2. 看看是否有可利用的 API 从而不必自己保存这些权限判断状态

我们选择 2 进行一下探究

我们入手的点包括：
```java
checkSelfPermission
shouldShowRequestPermissionRationale
requestPermissions
onRequestPermissionsResult
```



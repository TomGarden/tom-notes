

```xml
activity_main.xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    tools:context=".MainActivity">

    <Button
        android:id="@+id/view_id_name"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="@string/btn_init_color_ffffffff_unneutral"
        android:textAllCaps="false" />


</LinearLayout>
```


## 0x01. 最开始我们写 Android 界面的时候

```java
public class MyActivity extends Activity {
  void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);
    
    this.findViewById(R.id.view_id_name);
    
  }
}
```

## 0x02 后来有了 `kotlin-android-extensions` 

kotlin-android-extensions
1. 只适用于 Kotlin 不适用 Java
2. 持续持有所有使用过的 View 

我们写的代码

```kotlin
import kotlinx.android.synthetic.main.activity_main.*

class MainActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        view_id_name.text = "text1234"
    }
}
```

将 Kotlin 转换成 Java (AndroidStudio : Tool -> Kotlin -> Show kotlin bytecodes -> Decomplete)代码可以看到实际动作
```java
public final class MyActivity extends AppCompatActivity {
   private HashMap _$_findViewCache;

   protected void onCreate(@Nullable Bundle savedInstanceState) {
      super.onCreate(savedInstanceState);
      this.setContentView(1300101);
      TextView var10000 = (TextView)this._$_findCachedViewById(id.tvLogCat);
      Intrinsics.checkNotNullExpressionValue(var10000, "tvLogCat");
      var10000.setText((CharSequence)"text1234");
   }

   public View _$_findCachedViewById(int var1) {
      if (this._$_findViewCache == null) {
         this._$_findViewCache = new HashMap();
      }

      View var2 = (View)this._$_findViewCache.get(var1);
      if (var2 == null) {
         var2 = this.findViewById(var1);
         this._$_findViewCache.put(var1, var2);
      }

      return var2;
   }

   public void _$_clearFindViewByIdCache() {
      if (this._$_findViewCache != null) {
         this._$_findViewCache.clear();
      }

   }
}
```


## 再后来 Google 更推荐 ViewBinding

1. 不限制编程语言
2. 持续持有所有 View 
3. view 的访问方式不是从 容器获得 , 而是直接使用. 


我们的代码变成这个样子
```kotlin
class MainActivity : AppCompatActivity() {

    lateinit var viewBinding: ActivityMainBinding

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        viewBinding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(viewBinding.root)

        viewBinding.btn
    }
}
```

ActivityMainBinding 文件的内容 , build 后可见 `build/generated/data_binding_base_class_source_out/debug/out/io/github/tomgarden/databinding/ActivityMainBinding.java`
```java
// Generated by view binder compiler. Do not edit!
package io.github.tomgarden.databinding;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.LinearLayout;
import android.widget.TextView;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.viewbinding.ViewBinding;
import androidx.viewbinding.ViewBindings;
import io.github.tomgarden.R;
import java.lang.NullPointerException;
import java.lang.Override;
import java.lang.String;

public final class ActivityMainBinding implements ViewBinding {
  @NonNull
  private final LinearLayout rootView;

  @NonNull
  public final Button btn;

  @NonNull
  public final Button btnThree;

  @NonNull
  public final Button btnTwo;

  @NonNull
  public final TextView tv;

  private ActivityMainBinding(@NonNull LinearLayout rootView, @NonNull Button btn,
      @NonNull Button btnThree, @NonNull Button btnTwo, @NonNull TextView tv) {
    this.rootView = rootView;
    this.btn = btn;
    this.btnThree = btnThree;
    this.btnTwo = btnTwo;
    this.tv = tv;
  }

  @Override
  @NonNull
  public LinearLayout getRoot() {
    return rootView;
  }

  @NonNull
  public static ActivityMainBinding inflate(@NonNull LayoutInflater inflater) {
    return inflate(inflater, null, false);
  }

  @NonNull
  public static ActivityMainBinding inflate(@NonNull LayoutInflater inflater,
      @Nullable ViewGroup parent, boolean attachToParent) {
    View root = inflater.inflate(R.layout.activity_main, parent, false);
    if (attachToParent) {
      parent.addView(root);
    }
    return bind(root);
  }

  @NonNull
  public static ActivityMainBinding bind(@NonNull View rootView) {
    // The body of this method is generated in a way you would not otherwise write.
    // This is done to optimize the compiled bytecode for size and performance.
    int id;
    missingId: {
      id = R.id.btn;
      Button btn = ViewBindings.findChildViewById(rootView, id);
      if (btn == null) {
        break missingId;
      }

      id = R.id.btnThree;
      Button btnThree = ViewBindings.findChildViewById(rootView, id);
      if (btnThree == null) {
        break missingId;
      }

      id = R.id.btn_two;
      Button btnTwo = ViewBindings.findChildViewById(rootView, id);
      if (btnTwo == null) {
        break missingId;
      }

      id = R.id.tv;
      TextView tv = ViewBindings.findChildViewById(rootView, id);
      if (tv == null) {
        break missingId;
      }

      return new ActivityMainBinding((LinearLayout) rootView, btn, btnThree, btnTwo, tv);
    }
    String missingId = rootView.getResources().getResourceName(id);
    throw new NullPointerException("Missing required view with ID: ".concat(missingId));
  }
}

```


## 关于原理 
`kotlin-android-extensions` 通过 Gradle 插件修改现有代码 . 
和 `ViewBinding` , 都是通过 gradle 插件生成 Binding 代码 . 


## 参考
1. https://xuyisheng.top/viewbinding1/
2. https://developer.android.com/topic/libraries/view-binding
3. https://juejin.cn/post/7155491115645435917
4. https://bytedance.host/220618-viewbinding/
5. https://www.jianshu.com/p/431c040b6af8